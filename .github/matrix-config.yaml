# Matrix Configuration for Web Frameworks CI
# This file defines the three-level nested matrix structure:
# 1. Languages
# 2. Frameworks (per language)
# 3. Runtime versions (per framework)

# Language Runtime Versions
# Define available runtime versions for each language
runtimes:
  python:
    - "3.9"
    - "3.10"
    - "3.11"
    - "3.12"
    - "3.13"
  javascript:
    node:
      - "18"
      - "20"
      - "21"
      - "22"
    deno:
      - "1.40"
      - "1.41"
      - "2.0"
    bun:
      - "1.0"
      - "1.1"
  java:
    - "11"
    - "17"
    - "21"
  go:
    - "1.21"
    - "1.22"
    - "1.23"
  ruby:
    - "3.1"
    - "3.2"
    - "3.3"
  php:
    - "8.1"
    - "8.2"
    - "8.3"
  rust:
    - "1.75"
    - "1.76"
    - "1.77"
  csharp:
    - "6.0"
    - "7.0"
    - "8.0"
  kotlin:
    - "1.9"
    - "2.0"
  swift:
    - "5.9"
    - "5.10"
  elixir:
    - "1.15"
    - "1.16"
  crystal:
    - "1.10"
    - "1.11"
  nim:
    - "2.0"
    - "2.2"
  dart:
    - "3.1"
    - "3.2"
  scala:
    - "2.13"
    - "3.3"
  clojure:
    - "1.11"
    - "1.12"
  haskell:
    - "9.6"
    - "9.8"
  cpp:
    - "gcc-12"
    - "gcc-13"
    - "clang-16"
  c:
    - "gcc-12"
    - "gcc-13"
  d:
    - "2.105"
    - "2.106"
  fsharp:
    - "7.0"
    - "8.0"
  julia:
    - "1.9"
    - "1.10"
  lua:
    - "5.4"
  v:
    - "0.4"
  zig:
    - "0.11"
    - "0.12"
  gleam:
    - "0.34"
    - "1.0"
  ocaml:
    - "4.14"
    - "5.0"
  perl:
    - "5.38"
  r:
    - "4.3"
  guile:
    - "3.0"
  objc:
    - "clang-16"

# Default runtime version for each language
# Used when no specific version is requested
default_runtimes:
  python: "3.12"
  javascript:
    node: "20"
    deno: "2.0"
    bun: "1.1"
  java: "21"
  go: "1.23"
  ruby: "3.3"
  php: "8.3"
  rust: "1.77"
  csharp: "8.0"
  kotlin: "2.0"
  swift: "5.10"
  elixir: "1.16"
  crystal: "1.11"
  nim: "2.2"
  dart: "3.2"
  scala: "3.3"
  clojure: "1.12"
  haskell: "9.8"
  cpp: "gcc-13"
  c: "gcc-13"
  d: "2.106"
  fsharp: "8.0"
  julia: "1.10"
  lua: "5.4"
  v: "0.4"
  zig: "0.12"
  gleam: "1.0"
  ocaml: "5.0"
  perl: "5.38"
  r: "4.3"
  guile: "3.0"
  objc: "clang-16"

# Matrix Optimization Settings
optimization:
  # Maximum number of matrix jobs to run in parallel
  max_parallel_jobs: 256
  
  # Enable selective testing based on file changes
  selective_testing: true
  
  # Run full matrix on these branches
  full_matrix_branches:
    - main
    - master
  
  # Test only default runtime on pull requests unless specific paths are changed
  pr_default_runtime_only: true
  
  # Paths that trigger full runtime testing for a language
  runtime_trigger_paths:
    python:
      - "python/*/Dockerfile"
      - "python/config.yaml"
    javascript:
      - "javascript/*/Dockerfile"
      - "javascript/*/*.Dockerfile"
      - "javascript/config.yaml"
    java:
      - "java/*/Dockerfile"
      - "java/config.yaml"
    go:
      - "go/*/Dockerfile"
      - "go/config.yaml"
    # Add similar patterns for other languages as needed

# Cache Configuration
cache:
  # Enable dependency caching
  enabled: true
  
  # Cache keys per language
  cache_paths:
    python:
      - ~/.cache/pip
    javascript:
      node:
        - ~/.npm
      bun:
        - ~/.bun/install/cache
      deno:
        - ~/.cache/deno
    java:
      - ~/.m2/repository
      - ~/.gradle/caches
    go:
      - ~/go/pkg/mod
    ruby:
      - vendor/bundle
    php:
      - ~/.composer/cache
    rust:
      - ~/.cargo/registry
      - ~/.cargo/git
      - target
    csharp:
      - ~/.nuget/packages

# Framework Runtime Overrides
# Specific frameworks that require specific runtime versions
framework_runtime_overrides:
  # Example: A framework that only works with specific versions
  # python/django:
  #   - "3.10"
  #   - "3.11"
  #   - "3.12"

# Excluded Combinations
# Framework/runtime combinations that are known to be incompatible
exclusions:
  # Examples (uncomment and modify as needed):
  # - language: python
  #   framework: django
  #   runtime: "3.9"
  # - language: javascript
  #   framework: express
  #   engine: node
  #   runtime: "16"
  # - language: go
  #   framework: old-framework
  #   runtime: "1.21"
  
  # Note: Leave this list empty if there are no exclusions yet.
  # Add exclusions as incompatibilities are discovered during testing.
