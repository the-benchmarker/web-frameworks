# Nested CI Matrix System - Visual Overview

## System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    GitHub Actions Workflow                       â”‚
â”‚                      (.github/workflows/ci.yml)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Matrix Generation Job                       â”‚
â”‚  â€¢ Detects changed files                                        â”‚
â”‚  â€¢ Runs: bundle exec rake ci:matrix                             â”‚
â”‚  â€¢ Outputs JSON matrix                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Matrix Configuration Layer                     â”‚
â”‚              (.github/matrix-config.yaml)                        â”‚
â”‚  â€¢ Runtime versions                                             â”‚
â”‚  â€¢ Default runtimes                                             â”‚
â”‚  â€¢ Optimization settings                                        â”‚
â”‚  â€¢ Cache paths                                                  â”‚
â”‚  â€¢ Overrides & exclusions                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Three-Level Matrix Structure                   â”‚
â”‚                                                                  â”‚
â”‚  Level 1: LANGUAGES                                             â”‚
â”‚  â”œâ”€â”€ Python                                                     â”‚
â”‚  â”œâ”€â”€ JavaScript (Node.js, Deno, Bun)                           â”‚
â”‚  â”œâ”€â”€ Java                                                       â”‚
â”‚  â”œâ”€â”€ Go                                                         â”‚
â”‚  â”œâ”€â”€ Ruby                                                       â”‚
â”‚  â”œâ”€â”€ PHP                                                        â”‚
â”‚  â””â”€â”€ ... (25+ languages)                                        â”‚
â”‚                                                                  â”‚
â”‚  Level 2: FRAMEWORKS (per language)                             â”‚
â”‚  â”œâ”€â”€ Python                                                     â”‚
â”‚  â”‚   â”œâ”€â”€ Django                                                 â”‚
â”‚  â”‚   â”œâ”€â”€ Flask                                                  â”‚
â”‚  â”‚   â”œâ”€â”€ FastAPI                                                â”‚
â”‚  â”‚   â””â”€â”€ ... (30+ frameworks)                                   â”‚
â”‚  â”œâ”€â”€ JavaScript                                                 â”‚
â”‚  â”‚   â”œâ”€â”€ Express                                                â”‚
â”‚  â”‚   â”œâ”€â”€ Fastify                                                â”‚
â”‚  â”‚   â”œâ”€â”€ Koa                                                    â”‚
â”‚  â”‚   â””â”€â”€ ... (60+ frameworks)                                   â”‚
â”‚  â””â”€â”€ ...                                                        â”‚
â”‚                                                                  â”‚
â”‚  Level 3: RUNTIMES (per framework)                              â”‚
â”‚  â”œâ”€â”€ Python: 3.9, 3.10, 3.11, 3.12, 3.13                       â”‚
â”‚  â”œâ”€â”€ Node.js: 18, 20, 21, 22                                   â”‚
â”‚  â”œâ”€â”€ Java: 11, 17, 21                                           â”‚
â”‚  â”œâ”€â”€ Go: 1.21, 1.22, 1.23                                       â”‚
â”‚  â””â”€â”€ ...                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Test Execution Matrix                       â”‚
â”‚  â€¢ Up to 256 parallel jobs                                      â”‚
â”‚  â€¢ Each job: language + framework + engine + runtime           â”‚
â”‚  â€¢ Cached dependencies                                          â”‚
â”‚  â€¢ Runtime-specific setup                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Decision Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Code Change    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Detect Changed Files       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Is it a PR or Main?        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚             â”‚              â”‚
         â–¼             â–¼              â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   PR   â”‚   â”‚  Main  â”‚    â”‚ Master   â”‚
    â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
        â”‚            â”‚               â”‚
        â–¼            â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚ Runtime Files   â”‚          â–¼
â”‚   Changed?      â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ Test All        â”‚
    â”‚                  â”‚ Runtime         â”‚
    â”œâ”€â”€Yesâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ Versions        â”‚
    â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Test Default    â”‚
â”‚ Runtime Only    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Apply Overrides            â”‚
â”‚  â€¢ Framework-specific       â”‚
â”‚  â€¢ Runtime constraints      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Apply Exclusions           â”‚
â”‚  â€¢ Known incompatibilities  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Limit to Max Jobs (256)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Generate JSON Matrix       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Execute Test Jobs          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Matrix Size Comparison

### Before (Single Runtime)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”
â”‚   Language   â”‚  Frameworks â”‚ Jobs â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤
â”‚   Python     â”‚     30      â”‚  30  â”‚
â”‚ JavaScript   â”‚     60      â”‚  60  â”‚
â”‚     Java     â”‚     20      â”‚  20  â”‚
â”‚     Go       â”‚     40      â”‚  40  â”‚
â”‚    Other     â”‚     50      â”‚  50  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤
â”‚    Total     â”‚    200      â”‚ 200  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜
```

### After (Multiple Runtimes) - Main Branch
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Language   â”‚  Frameworks â”‚ Runtimes â”‚   Jobs   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Python     â”‚     30      â”‚    5     â”‚   150    â”‚
â”‚ JavaScript   â”‚     60      â”‚    4     â”‚   240    â”‚
â”‚     Java     â”‚     20      â”‚    3     â”‚    60    â”‚
â”‚     Go       â”‚     40      â”‚    3     â”‚   120    â”‚
â”‚    Other     â”‚     50      â”‚    2     â”‚   100    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    Total     â”‚    200      â”‚    -     â”‚   670    â”‚
â”‚ (Limited to) â”‚             â”‚          â”‚  (256)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### After (Selective Testing) - Pull Requests
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”
â”‚   Language   â”‚  Frameworks â”‚ Runtimes â”‚ Jobs â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤
â”‚   Python     â”‚     30      â”‚    1*    â”‚  30  â”‚
â”‚ JavaScript   â”‚     60      â”‚    1*    â”‚  60  â”‚
â”‚     Java     â”‚     20      â”‚    1*    â”‚  20  â”‚
â”‚     Go       â”‚     40      â”‚    1*    â”‚  40  â”‚
â”‚    Other     â”‚     50      â”‚    1*    â”‚  50  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤
â”‚    Total     â”‚    200      â”‚    -     â”‚ 200  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜
* Default runtime only
```

## Example: Python FastAPI Testing

### PR Mode (Default)
```
python/fastapi/app.py changed
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FastAPI                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Runtime: 3.12 (default)     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Engines:                    â”‚
â”‚  â€¢ uvicorn                   â”‚
â”‚  â€¢ hypercorn                 â”‚
â”‚  â€¢ daphne                    â”‚
â”‚  â€¢ granian                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
    4 test jobs
```

### Main Branch Mode (Full)
```
python/fastapi/app.py changed
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FastAPI                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Runtimes: 3.9, 3.10,        â”‚
â”‚            3.11, 3.12, 3.13  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Engines (each runtime):     â”‚
â”‚  â€¢ uvicorn                   â”‚
â”‚  â€¢ hypercorn                 â”‚
â”‚  â€¢ daphne                    â”‚
â”‚  â€¢ granian                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
   20 test jobs
(5 runtimes Ã— 4 engines)
```

### Runtime Trigger Mode
```
python/config.yaml changed
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ALL Python Frameworks       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Runtimes: 3.9, 3.10,        â”‚
â”‚            3.11, 3.12, 3.13  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Each framework with all     â”‚
â”‚  its engines and runtimes    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
  Limited to 256 jobs
```

## Feature Highlights

### ğŸ¯ Intelligent Testing
```
PR:         Fast feedback with default runtime
Main:       Comprehensive coverage with all runtimes
Triggers:   Smart detection of runtime changes
```

### âš¡ Performance
```
Caching:    Language-specific dependency caching
Parallel:   Up to 256 jobs in parallel
Selective:  Test only what changed (on PRs)
```

### ğŸ”§ Flexibility
```
Overrides:  Framework-specific runtime versions
Exclusions: Skip incompatible combinations
Dynamic:    Matrix generated based on changes
```

### ğŸ“Š Optimization
```
Max Jobs:   256 (configurable)
PR Default: Single runtime per framework
Main Full:  All runtime combinations
```

## Configuration Files

```
.github/
â”œâ”€â”€ matrix-config.yaml          âš™ï¸ Central configuration
â”‚   â”œâ”€â”€ runtimes                    (runtime versions)
â”‚   â”œâ”€â”€ default_runtimes            (defaults per language)
â”‚   â”œâ”€â”€ optimization                (settings)
â”‚   â”œâ”€â”€ cache                       (cache paths)
â”‚   â”œâ”€â”€ framework_runtime_overrides (overrides)
â”‚   â””â”€â”€ exclusions                  (incompatibilities)
â”‚
â”œâ”€â”€ workflows/
â”‚   â””â”€â”€ ci.yml                  ğŸ”§ GitHub Actions workflow
â”‚
â”œâ”€â”€ MATRIX_SYSTEM.md            ğŸ“˜ Complete documentation
â”œâ”€â”€ MATRIX_QUICKREF.md          ğŸš€ Quick reference
â”œâ”€â”€ MATRIX_EXAMPLES.md          ğŸ“ Practical examples
â”œâ”€â”€ MIGRATION_GUIDE.md          ğŸ”„ Migration guide
â””â”€â”€ README.md                   ğŸ“– Documentation index

.tasks/
â””â”€â”€ ci.rake                     ğŸ”¨ Matrix generation logic

<language>/
â”œâ”€â”€ config.yaml                 ğŸŒ Language configuration
â””â”€â”€ <framework>/
    â””â”€â”€ config.yaml             ğŸ“¦ Framework configuration
```

## Benefits

### For Contributors
- âœ… Fast PR feedback (tests default runtime only)
- âœ… Comprehensive testing on main branch
- âœ… Clear documentation and examples
- âœ… Easy to add new frameworks

### For Maintainers
- âœ… Centralized configuration management
- âœ… Easy runtime version updates
- âœ… Resource-efficient testing
- âœ… Fine-grained control via overrides/exclusions

### For the Project
- âœ… Better test coverage across runtime versions
- âœ… Early detection of compatibility issues
- âœ… Scalable to new languages and frameworks
- âœ… Optimized CI resource usage

## Quick Commands

```bash
# View matrix for PR
export FILES='["python/fastapi/config.yaml"]'
export GITHUB_EVENT_NAME=pull_request
bundle exec rake ci:matrix | jq

# View matrix for main branch
export GITHUB_EVENT_NAME=push
export GITHUB_REF_NAME=main
bundle exec rake ci:matrix | jq

# Count total jobs
bundle exec rake ci:matrix | jq '.include | length'

# View specific language
bundle exec rake ci:matrix | jq '.include[] | select(.language == "python")'
```

## Learn More

- ğŸ“˜ [Complete Documentation](MATRIX_SYSTEM.md)
- ğŸš€ [Quick Reference](MATRIX_QUICKREF.md)
- ğŸ“ [Examples](MATRIX_EXAMPLES.md)
- ğŸ”„ [Migration Guide](MIGRATION_GUIDE.md)
